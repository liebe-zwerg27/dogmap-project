# Pawmap Project

このプロジェクトは、Django フレームワークと Docker を使用して構築された、ペットのための地図アプリケーションです。

## 概要

Pawmap は、ペット連れで行ける場所（公園、カフェ、動物病院など）を地図上に表示し、ユーザーが情報を共有できるプラットフォームを目指しています。

## 技術スタック

*   **バックエンド:** Python (3.9), Django (4.2), Gunicorn
*   **データベース:** MySQL 8.0
*   **ウェブサーバー:** Nginx
*   **コンテナオーケストレーション:** Docker, Docker Compose
*   **その他:** phpMyAdmin

## 開発環境の構築

このプロジェクトは Docker Compose を使用して簡単に開発環境を構築できます。

### 前提条件

*   Docker
*   Docker Compose

### 手順

1.  リポジトリをクローンします。

    ```bash
    git clone [リポジトリのURL]
    cd dogmap-project
    ```

2.  環境変数を設定します。`.env` ファイルを作成し、以下の変数を設定してください。

    ```
    SECRET_KEY=<DjangoのSECRET_KEY>
    GOOGLE_MAPS_API_KEY=<Google Maps APIキー>
    MYSQL_USER=<MySQLユーザー名>
    MYSQL_PASSWORD=<MySQLパスワード>
    MYSQL_ROOT_PASSWORD=<MySQL rootパスワード>
    PMA_USER=<phpMyAdminユーザー名>
    PMA_PASSWORD=<phpMyAdminパスワード>
    DEBUG=True # 開発環境の場合
    ALLOWED_HOSTS=* # 開発環境の場合。本番環境では適切なホスト名を指定
    CSRF_TRUSTED_ORIGINS=* # 開発環境の場合。本番環境では適切なオリジンを指定
    ```

    **重要:** `.env` ファイルは `.gitignore` に追加して、リポジトリにコミットしないようにしてください。

3.  Docker Compose でコンテナを起動します。

    ```bash
    docker-compose up -d --build
    ```

4.  Django のマイグレーションを実行します。

    ```bash
    docker-compose exec web python manage.py migrate
    ```

5.  管理ユーザーを作成します（必要に応じて）。

    ```bash
    docker-compose exec web python manage.py createsuperuser
    ```

6.  ウェブブラウザで `http://localhost:8000` にアクセスします。phpMyAdmin は `http://localhost:3000` でアクセスできます。

## 本番環境へのデプロイ

本番環境へのデプロイでは、以下の点を考慮してください。

*   `DEBUG = False` に設定します。
*   `ALLOWED_HOSTS` と `CSRF_TRUSTED_ORIGINS` に適切なホスト名とオリジンを指定します。
*   SSL 証明書を設定します。本番環境の Nginx 設定 (`nginx/conf.d/default.conf`) を適切に設定してください。Let's Encrypt などを使用して証明書を取得することを推奨します。
*   環境変数は、サーバー環境に合わせて適切に設定します。
*   静的ファイルは `collectstatic` コマンドで収集し、Nginx から配信するように設定します。
*   `default.conf` の `listen` ポートを `80` と `443` に変更し、HTTP から HTTPS へのリダイレクトを設定します。

## ディレクトリ構成
```
.
├── Dockerfile          # Dockerfile
├── docker-compose.yml    # Docker Compose設定ファイル
├── myproject           # Djangoプロジェクト
│   ├── accounts        # ユーザー認証アプリ
│   ├── manage.py       # Django管理スクリプト
│   ├── myproject       # プロジェクト設定
│   │   ├── settings.py # 設定ファイル
│   │   ├── urls.py     # URLルーティング
│   │   └── wsgi.py     # WSGI設定
│   ├── pawmap          # メインアプリ
│   └── templates       # テンプレート
├── nginx               # Nginx設定
│   └── conf.d
│       └── default.conf # Nginx設定ファイル
├── requirements.txt    # Python依存パッケージリスト
└── staticfiles          # 静的ファイル
```

## ブランチ構成について

本プロジェクトでは、開発用とgithubへの公開用で異なるブランチを使用しています。

*   **公開用ブランチ (`pub`):** このブランチはGitHubで公開するためのブランチです。開発用ブランチ内の個人情報や機密情報を含まないように構成されています。
*   **開発用ブランチ (非公開):** 実際の開発作業はこのブランチで行っています。Google Maps APIやDjangoのSECRET KEY等の個人情報を含む過去のコミット履歴が存在するこのブランチはGitHubには公開していません。

## 使用方法

このセクションでは、Pawmap アプリケーションの基本的な使い方を説明します。

### ホームページ (一覧表示)

アプリケーションのホームページ (`/`) にアクセスすると、登録されているお出かけスポットの一覧が表示されます。

*   **カテゴリ絞り込み:** ページ上部のドロップダウンリストからカテゴリを選択することで、特定のカテゴリのスポットのみを表示できます。「すべて」を選択すると、すべてのカテゴリのスポットが表示されます。
*   **都道府県絞り込み:** ページ上部のドロップダウンリストから都道府県を選択することで、特定の都道府県のスポットのみを表示できます。「すべて」を選択すると、すべての都道府県のスポットが表示されます。
*   **スポット詳細:** スポット名をクリックすると、そのスポットの詳細ページ (`/sites/<id>/`) に移動します。
*   **スポット追加 (ログインユーザーのみ):** ログインしているユーザーは、ページ下部に表示される「お出かけスポットを追加する」リンクをクリックすることで、新しいスポットを登録できます (`/sites/create/`)。

### スポット詳細ページ

スポット詳細ページ (`/sites/<id>/`) では、選択したスポットの詳細情報を確認できます。

*   **スポット情報:** スポットのカテゴリと住所が表示されます。
*   **Google Maps の埋め込み:** スポットの住所に基づいて Google Maps の埋め込み地図が表示されます。
*   **編集・削除 (投稿者のみ):** スポットを投稿したユーザーは、「編集する」(`/sites/<id>/update/`) および「削除する」(`/sites/<id>/delete/`) リンクが表示され、スポット情報の編集や削除を行うことができます。
*   **一覧に戻る:** 「一覧に戻る」リンクをクリックすると、スポット一覧ページに戻ります。

### スポットの追加・編集

スポットの追加ページ (`/sites/create/`)、またはスポット詳細ページから「編集する」リンクをクリック (`/sites/<id>/update/`) して、スポット情報を登録・編集できます。

*   **フォーム:** 必要な情報を入力するフォームが表示されます。
*   **作成/更新ボタン:** フォームに入力後、「作成」または「更新」ボタンをクリックして情報を保存します。
*   **戻る:** 「戻る」リンクをクリックすると、前のページに戻ります。

### スポットの削除

スポットの削除ページ (`/sites/<id>/delete/`) では、スポットの削除を確認できます。

*   **確認メッセージ:** 削除するスポットの名前が表示され、削除するかどうかの確認を求められます。
*   **削除ボタン:** 「削除する」ボタンをクリックすると、スポットが削除されます。
*   **戻る:** 「戻る」リンクをクリックすると、前のページに戻ります。

### メニュー

ナビゲーションバーのドロップダウンメニューには、以下のリンクが含まれています。

*   ホーム (`/` にアクセス)
*   全体マップ (`/map/` にアクセス)
*   ご利用方法 (`/how_to_use/` にアクセス)
*   このサイトについて (`/about/` にアクセス)

### ご利用方法ページ

ご利用方法ページ (`/how_to_use/`) では、このサイトの使い方について説明しています。

*   お出かけスポット検索
*   スポットの投稿
*   スポットの編集・削除
*   全体マップの使用 (将来実装予定)

### このサイトについてページ

このサイトについてページ (`/about/`) では、このサイトについての情報が記載されています。

### 全体マップページ

全体マップページ (`/map/`) では、登録されているスポットが地図上に表示されます。

### ログイン・ログアウト・サインアップ

*   **ログイン:** ナビゲーションバーの「Login」リンクをクリックすると、ログインページに移動します。
*   **ログアウト:** ログインしている場合は、ナビゲーションバーにユーザー名と「Logout」リンクが表示されます。「Logout」リンクをクリックするとログアウトします。
*   **サインアップ:** ナビゲーションバーの「Sign up」リンクをクリックすると、サインアップページに移動します。
